# -*- coding: utf-8; -*-


* top level 
** header
   #+BEGIN_SRC emacs-lisp
; -*- coding: utf-8; -*-
   #+END_SRC
** smerge
   #+BEGIN_SRC emacs-lisp
     (require 'smerge-mode)
   #+END_SRC 

** excommand
   #+BEGIN_SRC emacs-lisp

     ;; http://d.hatena.ne.jp/tarao/20130304/evil_config



     (defun evil-replace-word-selection()
       (interactive)
       (if (use-region-p)
           (let (
                 (selection (buffer-substring-no-properties (region-beginning) (region-end))))
             (if (= (length selection) 0)
                 (message "empty string")
               (evil-ex (concat "'<,'>s/" selection "/"))
               ))
         (evil-ex (concat "%s/" (thing-at-point 'word) "/"))))

     (evil-ex-define-cmd "[sc]ratch" #'tmpscratch)
   #+END_SRC
** leader

*** myown
    #+BEGIN_SRC emacs-lisp
      (spacemacs/set-leader-keys 
        "<backtab>" #'back-to-indentation
        "<backspace>" #'twin
        "%" 'evil-virep-replace-regexp
        "ak" 'kproc
        "a[" 'w32shell-cmd-here
        "yi" 'yankpad-insert
        "ye" 'yankpad-edit
        "ym" 'yankpad-map
        "yc" 'yankpad-set-category
        "oj" 'open-junk-file
        "obi" 'ido-switch-buffer-other-frame
        "oba" 'ivy-push-view
        "obA" 'ivy-pop-view
        "obb" 'ivy-switch-buffer-other-window
        "obB" 'ivy-switch-buffer
        "bb"  'switch-to-buffer
        "ob[" 'evil-prev-buffer
        "obk" 'kill-this-buffer
        "ob]" 'evil-next-buffer
        "obn" 'narrow-to-region
        "obN" 'narrow-to-defun
        "obw" 'widen
        "obs" 'save-buffer
        "obS" 'save-some-buffers
        "obm" 'boomark-set
        "obj" 'boomark-jump
        "obM" 'bookmark-bmenu-list
        "obl" 'xah-open-last-closed
        "obf" 'prelude-copy-file-name-to-clipboard
        "obh" 'mark-whole-buffer
        "obr" 'revert-buffer
        "obc" 'xah-close-current-buffer
        "of"   'helm-resume
        "iu"   nil
        ;; "<home>" 'ibuffer
        "<home>" 'bufler
        "<end>" 'tmpscratch
        "<prior>" 'beginning-of-defun
        "<next>" 'end-of-defun
        "<delete>" 'switch-window

        "oO"  'switch-window
        "o1" 'switch-window-then-maximize
        "o2" 'switch-window-then-split-below
        "o3" 'switch-window-then-split-right
        "o0" 'switch-window-then-delete

        "o4d" 'switch-window-then-dired
        "o4f" 'switch-window-then-find-file
        "o4m" 'switch-window-then-compose-mail
        "o4r" 'switch-window-then-find-file-read-only
        "o4b" 'switch-window-then-display-buffer
        "o40" 'switch-window-then-kill-buffer

        ;; "d" 'dired
        "," 'smex
        "." 'embrace-commander
        "/" 'evil-replace-word-selection
        "\\" 'xah-copy-file-path
        "-" 'xah-copy-file-name
        "osL" 'loccur
        "oo" 'occur
        "osn" 'smartscan-symbol-go-forward
        "osp" 'smartscan-symbol-go-backward
        "osc" 'xah-lookup-cppreference
        "os." 'gtags-find-tag
        "os," 'gtags-pop-stack
        "os_" 'isearch-forward-symbol
        "os-" 'isearch-forward-at-point
        "osm" 'grep-word
        "ost" 'xah-find-text
        "osT" 'xah-find-text-regex

        "ou"  'hydra-undo-tree/body
        "op" 'pandoc-main-hydra/body

        "S" smerge-basic-map

        "u" 'counsel-recentf;;helm-choose-from-recentf  ;;'string-rectangle ;;'recentf-open-most-recent-file
        "U" 'counsel-recentf-directory ;;helm-goto-recent-directory ;;counsel-goto-recent-directory ;;;;'string-rectangle ;;'recentf-open-most-recent-file
        ";" 'evilnc-comment-or-uncomment-lines

        "oCw" #'wcopy ;;deprecated;;'evilnc-copy-and-comment-lines
        "oCx" #'crux-open-with
        "oCO" #'crux-smart-open-line-above
        "oCo" #'crux-smart-open-line
        "oCs" #'crux-cleanup-buffer-or-region
        "oCr" #'crux-recentf-ido-find-file
        "oCv" #'crux-view-url
        "oCe" #'crux-eval-and-replace
        "oCt" #'crux-transpose-windows
        "oCD" #'crux-delete-file-and-buffer
        "oCl" #'crux-duplicate-current-line-or-region
        "oCL" #'crux-duplicate-and-comment-current-line-or-region
        "oCR" #'crux-rename-file-and-buffer
        "oCn" #'crux-visit-term-buffer
        "oC1" #'crux-kill-other-buffers
        "oCi" #'crux-indent-defun
        "oCI" #'crux-indent-rigidly-and-copy-to-clipboard
        "oC." #'crux-find-user-init-file
        "oCs" #'crux-find-shell-init-file
        "oCj" #'crux-top-join-lines
        "oCk" #'crux-kill-whole-line
        "oCK" #'crux-kill-line-backwards
        "oCa" #'crux-ispell-word-then-abbrev




        "o]" 'exit-recursive-edit
        "ov" 'evil-scroll-down
        "oV" 'evil-scroll-up

        "G" 'keyboard-quit
        "ee" 'eval-last-sexp
        "E"  mu4e-main-mode-map
        "Eu" 'mu4e-update-mail-and-index


        "W" 'read-only-mode
        "oww" 'read-only-mode
        "ow1" 'delete-other-windows
        "ow2" 'split-window-below
        "ow3" 'split-window-right
        "ow0" 'delete-window
        "owd" 'delete-blank-lines
        "ows" 'resize-window
        "owj"      'winner-undo
        "owk"      'winner-redo

        "as" 'twin
        "aw" 'winexe
        ;;deprecattion;;"+" #'evil-numbers/inc-at-pt
        ;;deprecattion;;"-" #'evil-numbers/dec-at-pt
        ;;deprecattion;;"M" #'pop-to-mark-command ;;'evil-scroll-down
        ;;deprecattion;;"m" #'er/expand-region ;;#'extend-selection
        ;;deprecattion;;"S-m" #'mark-line ;;#'extend-selection
        ;;deprecattion;;"<" #'loccur
        ;;deprecattion;;"0" #'delete-window
        ;;deprecattion;;"1" #'delete-other-windows
        ;;deprecattion;;"2" #'split-window-below
        ;;deprecattion;;"3" #'split-window-right
        ;;deprecattion;;"(" #'kmacro-start-macro
        ;;deprecattion;;")" #'kmacro-end-macro
        ;;deprecattion;;"xx"  #'kmacro-end-and-call-macro
        ;;deprecattion;;"xi"  #'string-inflection-all-cycle
        ;;deprecattion;;"D" #'toggle-current-window-dedication
        ;;deprecattion;;"kb" 'kill-buffer
        ;;deprecattion;;"op"  (cdar (cddr  (cadr  projectile-mode-map)))
        ;;deprecattion;;"opw"  'purpose-load-window-layout
        ;;deprecattion;;"opW"  'purpose-save-window-layout
        ;;deprecattion;;"opE"  'project-explorer-open
        ;;deprecattion;;"opC"  'project-explorer-close
        ;;deprecattion;;"op/"  'projectile-grep
        ;;deprecattion;;"<SPC>" #'smex

        "ohz" 'zeal-at-point
        "ohh"      'helm-mini
        "oha"      'helm-apropos
        "ohB"      'helm-buffers-list
        "ohb"      'helm-descbindings
        "ohy"      'helm-show-kill-ring
        "ohx"      'helm-M-x
        "oho"     'helm-occur
        "ohs"     'helm-swoop
        "ohy"     'helm-yas-complete
        "ohY"     'helm-yas-create-snippet-on-region
        "ohr" 'helm-all-mark-rings
        "ohm" 'helm-smex
        "ohM" 'helm-smex-major-mode-commands
        "od"  'counsel-goto-recent-directory

        "om" 'switch-window-then-orgmail
        "oM" 'orgmail
        "oS" 'tmpscratch
        "oI" 'ibuffer
        "ox" 'winexe
        "or" 'org-capture
        "oa" 'org-agenda
        "ol" 'org-store-link
        "oc" 'org-cliplink
        "oG"  'gxref-set-project-dir
        "ogd" 'gxref-set-project-dir
        "ogc" 'gxref-clear-project-dir
        "ogu" 'gxref-update-db
        "[" 'ivy-push-view 
        "]" 'ivy-pop-view 
        "ph" 'project-explorer-helm
        "pH" 'project-explorer-open
        "px" 'project-explorer-close

        )
    #+END_SRC

    #+RESULTS:

*** expand spacemacs
**** global
     #+BEGIN_SRC emacs-lisp

       (spacemacs/set-leader-keys
         ;; xl from spacemacs 
         "xll" 'sort-lines-length
         "xlU" 'uniq-region
         "xlS" 'sort-lines
         "xn"  'xah-space-to-newline
         "&"   'org-mark-ring-goto
         "nx"  'zz-narrow-repeat
         "nz"  narrow-map
         ;; "bb"  'ivy-switch-buffer
         "bb"  'bufler-switch-buffer
         "bf"  'bufler-workspace-frame-set
         "si"  'spacemacs/search-project-auto-region-or-symbol
         ;;sdcv dictionary
         "sV" 'sdcv-search-pointer+
         "sv" 'sdcv-search-pointer
         "sN" 'sdcv-search-input+
         "sn" 'sdcv-search-input

         )
     #+END_SRC

     #+RESULTS:

**** for major mode
     #+BEGIN_SRC emacs-lisp
       (spacemacs/set-leader-keys-for-major-mode 'org-mode
         "v" 'org-copy-visible
         "n" 'org-narrow-to-subtree
         )

       (spacemacs/set-leader-keys-for-major-mode 'mu4e-view-mode
         "&" 'org-mark-ring-goto)

       (spacemacs/set-leader-keys-for-major-mode 'mu4e-headers-mode
         "&" 'org-mark-ring-goto)

       (spacemacs/set-leader-keys-for-major-mode 'org-mode "os" ",',sb,c") 

     #+END_SRC

     #+RESULTS:


** evil default override 


   #+BEGIN_SRC emacs-lisp
  ;;deprecated;;(evilnc-default-hotkeys)

  ;;deprecated;;(global-set-key (kbd "C-x r t") 'inline-string-rectangle)
  (evil-set-toggle-key "<pause>")
  (define-key evil-normal-state-map "u" 'undo-fu-only-undo)
  (define-key evil-normal-state-map "U" 'undo-fu-only-redo)
  (define-key evil-normal-state-map [escape] 'keyboard-quit)
  (define-key evil-visual-state-map [escape] 'keyboard-quit)
  (define-key minibuffer-local-map [escape] 'minibuffer-keyboard-quit)
  (define-key minibuffer-local-ns-map [escape] 'minibuffer-keyboard-quit)
  (define-key minibuffer-local-completion-map [escape] 'minibuffer-keyboard-quit)
  (define-key minibuffer-local-must-match-map [escape] 'minibuffer-keyboard-quit)
  (define-key minibuffer-local-isearch-map [escape] 'minibuffer-keyboard-quit)
  ;; (define-key minibuffer-local-isearch-map [escape] 'keyboard-quit)
  ;;(define-key minibuffer-local-isearch-map [?\S- ] 'toggle-korean-input-method)




  ;;deprecated;;(global-set-key [M-return] 'smex)
  (define-key evil-normal-state-map (kbd "C-c +") #'evil-numbers/inc-at-pt)
  (define-key evil-normal-state-map (kbd "C-c -") #'evil-numbers/dec-at-pt)
  (define-key evil-normal-state-map "zx" 'smex)


  (define-key evil-normal-state-map "\C-a" 'evil-beginning-of-line)
  (define-key evil-insert-state-map "\C-a" 'beginning-of-line)
  (define-key evil-visual-state-map "\C-a" 'evil-beginning-of-line)


  (define-key evil-normal-state-map "\C-e" 'evil-end-of-line)
  (define-key evil-insert-state-map "\C-e" 'end-of-line)
  (define-key evil-visual-state-map "\C-e" 'evil-end-of-line)
  (define-key evil-normal-state-map "\C-f" 'evil-forward-char)
  (define-key evil-insert-state-map "\C-f" 'evil-forward-char)
  (define-key evil-insert-state-map "\C-f" 'evil-forward-char)
  (define-key evil-normal-state-map "\C-b" 'evil-backward-char)
  (define-key evil-insert-state-map "\C-b" 'evil-backward-char)
  (define-key evil-visual-state-map "\C-b" 'evil-backward-char)
  (define-key evil-normal-state-map "\C-d" 'evil-delete-char)
  (define-key evil-insert-state-map "\C-d" 'evil-delete-char)
  (define-key evil-visual-state-map "\C-d" 'evil-delete-char)
  (define-key evil-normal-state-map "\C-n" 'evil-next-line)
  (define-key evil-insert-state-map "\C-n" 'evil-next-line)
  (define-key evil-visual-state-map "\C-n" 'evil-next-line)
  (define-key evil-normal-state-map "\C-p" 'evil-previous-line)
  (define-key evil-insert-state-map "\C-p" 'evil-previous-line)
  (define-key evil-visual-state-map "\C-p" 'evil-previous-line)
  ;; (define-key evil-normal-state-map "\C-w" 'phi-rectangle-kill-region)
  ;; (define-key evil-insert-state-map "\C-w" 'phi-rectangle-kill-region)
  ;; (define-key evil-visual-state-map "\C-w" 'phi-rectangle-kill-region)
  (define-key evil-normal-state-map "\C-w" 'kill-region-dwim)
  (define-key evil-insert-state-map "\C-w" 'kill-region-dwim)
  (define-key evil-visual-state-map "\C-w" 'kill-region-dwim)
  (define-key evil-normal-state-map "\C-y" 'yank)
  (define-key evil-insert-state-map "\C-y" 'yank)
  (define-key evil-visual-state-map "\C-y" 'yank)
  (define-key evil-normal-state-map "\C-k" 'kill-line)
  (define-key evil-insert-state-map "\C-k" 'kill-line)
  (define-key evil-visual-state-map "\C-k" 'kill-line)
  (define-key evil-normal-state-map "Q" 'call-last-kbd-macro)
  (define-key evil-visual-state-map "Q" 'call-last-kbd-macro)

  ;;; http://leavinsprogramming.blogspot.kr/2012/05/evil-emacs-mode-for-vivim-users.html
  (defun evil-undefine ()
    (interactive)
    (let (evil-mode-map-alist)
      (call-interactively (key-binding (this-command-keys)))))
  (define-key evil-normal-state-map (kbd "TAB") 'evil-undefine)
  (define-key evil-motion-state-map "\C-]" 'find-tag-dwim)


  (define-key evil-normal-state-map "gl" 'goto-line)
  (define-key evil-normal-state-map "g[" 'beginning-of-buffer)
  (define-key evil-normal-state-map "g]" 'end-of-buffer      )
  (define-key evil-normal-state-map "g{" 'beginning-of-defun)
  (define-key evil-normal-state-map "g}" 'end-of-defun      )
  (define-key evil-normal-state-map "gg" 'revert-buffer)
  (define-key evil-normal-state-map "gR" 'xref-find-references)
  (define-key evil-normal-state-map "gr" 'xref-pop-marker-stack)


  (define-key evil-visual-state-map "gl" 'goto-line)
  (define-key evil-visual-state-map "g[" 'beginning-of-buffer)
  (define-key evil-visual-state-map "g]" 'end-of-buffer      )
  (define-key evil-visual-state-map "g{" 'beginning-of-defun)
  (define-key evil-visual-state-map "g}" 'end-of-defun      )
  (define-key evil-visual-state-map "gg" 'revert-buffer)
  (define-key evil-visual-state-map "gR" 'xref-find-references)
  (define-key evil-visual-state-map "gr" 'xref-pop-marker-stack)


  (define-key evil-normal-state-map "zf" 'vimish-fold-dwim) 
  ;; (define-key evil-visual-state-map "zf" 'vimish-fold) 
  (define-key evil-normal-state-map "zd" 'vimish-fold-delete) 
  (define-key evil-normal-state-map "zs" 'vimish-fold-next-fold) 
  (define-key evil-normal-state-map "zw" 'vimish-fold-previous-fold)

  (define-key evil-normal-state-map "zF" 'hs-toggle-hiding)


  ;; (define-key evil-motion-state-map "[[" 'backward-sexp)
  ;; (define-key evil-motion-state-map "]]" 'forward-sexp)

  (define-key evil-normal-state-map (kbd "C-c :" ) 'ac-complete-with-helm)
  (define-key evil-insert-state-map (kbd "C-c :" ) 'ac-complete-with-helm)

  (define-key evil-motion-state-map [down-mouse-1] 'mouse-drag-region)

   #+END_SRC

** kp map
   #+BEGIN_SRC emacs-lisp
     ;; kp-map 
     ;; (define-key evil-normal-state-map [kp-0]     'helm-smex)
     (define-key evil-normal-state-map [kp-0]        'copy-region-strip-left)
     (define-key evil-normal-state-map [kp-1]        'select-window-1)
     (define-key evil-normal-state-map [kp-2]        'select-window-2)
     (define-key evil-normal-state-map [kp-3]        'select-window-3)
     (define-key evil-normal-state-map [kp-4]        'evil-prev-buffer)
     (define-key evil-normal-state-map [kp-5]        'helm-mini)
     (define-key evil-normal-state-map [kp-6]        'evil-next-buffer)
     (define-key evil-normal-state-map [kp-8]        'split-window-below)
     (define-key evil-normal-state-map [kp-add]      'evil-paste-after)
     (define-key evil-normal-state-map [kp-enter]    'kmacro-end-and-call-macro)
     (define-key evil-normal-state-map [kp-decimal]  'winexe)
     (define-key evil-normal-state-map [kp-subtract] 'recenter-top-bottom)
     (define-key evil-normal-state-map [kp-7]        'copy-to-register-1)
     (define-key evil-normal-state-map [kp-9]        'paste-from-register-1)
     (define-key evil-normal-state-map [kp-divide]   'ibuffer)

     ;; (define-key evil-visual-state-map [kp-0]     'helm-smex)
     (define-key evil-visual-state-map [kp-0]        'copy-region-strip-left) 
     (define-key evil-visual-state-map [kp-1]        'select-window-1)
     (define-key evil-visual-state-map [kp-2]        'select-window-2)
     (define-key evil-visual-state-map [kp-3]        'select-window-3)
     (define-key evil-visual-state-map [kp-4]        'evil-prev-buffer)
     (define-key evil-visual-state-map [kp-5]        'helm-mini)
     (define-key evil-visual-state-map [kp-6]        'evil-next-buffer)
     (define-key evil-visual-state-map [kp-add]      'evil-yank)
     (define-key evil-visual-state-map [kp-enter]    'evil-paste-after)
     (define-key evil-visual-state-map [kp-decimal]  'winexe)
     (define-key evil-visual-state-map [kp-8]        'split-window-below)
     (define-key evil-visual-state-map [kp-subtract] 'recenter-top-bottom)
     (define-key evil-visual-state-map [kp-7]        'copy-to-register-1)
     (define-key evil-visual-state-map [kp-9]        'paste-from-register-1)
     (define-key evil-visual-state-map [kp-divide]   'ibuffer)
   #+END_SRC

   #+RESULTS:
   : ibuffer

** evil surround
   #+BEGIN_SRC emacs-lisp
     (leaf evil-surround
       :ensure t
       :global-minor-mode global-evil-surround-mode 
       :config
       (evil-define-key 'visual evil-surround-mode-map "s" 'evil-surround-region)
       )

     (leaf evil-embrace
       :ensure t
       :hook    (org-mode-hook . embrace-org-mode-hook)
       :config
       (evil-embrace-enable-evil-surround-integration))

   #+END_SRC

** auto complete

   #+BEGIN_SRC emacs-lisp
     ;;; Auto-complete
     (leaf auto-complete
       :ensure t
       :config
       (evil-add-command-properties 'ac-complete :repeat 'evil-ac-repeat)
       (evil-add-command-properties 'ac-expand :repeat 'evil-ac-repeat)
       (evil-add-command-properties 'ac-next :repeat 'ignore)
       (evil-add-command-properties 'ac-previous :repeat 'ignore)

       (defvar evil-ac-prefix-len nil
         "The length of the prefix of the current item to be completed.")

       (defun evil-ac-repeat (flag)
         "Record the changes for auto-completion."
         (cond
          ((eq flag 'pre)
           (setq evil-ac-prefix-len (length ac-prefix))
           (evil-repeat-start-record-changes))
          ((eq flag 'post)
           ;; Add change to remove the prefix
           (evil-repeat-record-change (- evil-ac-prefix-len)
                                      ""
                                      evil-ac-prefix-len)
           ;; Add change to insert the full completed text
           (evil-repeat-record-change
            (- evil-ac-prefix-len)
            (buffer-substring-no-properties (- evil-repeat-pos
                                               evil-ac-prefix-len)
                                            (point))
            0)
           ;; Finish repeation
           (evil-repeat-finish-record-changes)))))

   #+END_SRC

** evil extra operator
   #+BEGIN_SRC emacs-lisp
     ;; https://github.com/redguardtoo/evil-matchit/blob/master/README.org
     (leaf evil-matchit
       :ensure t
       :global-minor-mode global-evil-matchit-mode
       :config
       (plist-put evilmi-plugins 'xah-html-mode '((evilmi-html-get-tag evilmi-html-jump)))
       (plist-put evilmi-plugins 'web-mode '((evilmi-html-get-tag evilmi-html-jump))))


     (leaf evil-args
       :ensure t
       :config
       ;; bind evil-args text objects
       (define-key evil-inner-text-objects-map "a" 'evil-inner-arg)
       (define-key evil-outer-text-objects-map "a" 'evil-outer-arg)

       ;; bind evil-forward/backward-args
       (define-key evil-normal-state-map "L" 'evil-forward-arg)
       (define-key evil-normal-state-map "H" 'evil-backward-arg)
       (define-key evil-motion-state-map "L" 'evil-forward-arg)
       (define-key evil-motion-state-map "H" 'evil-backward-arg)

       ;; bind evil-jump-out-args
       (define-key evil-normal-state-map "K" 'evil-jump-out-args)

       (define-key evil-normal-state-map (kbd "<S-return>")
         (lambda ()
           (interactive)
           (call-interactively 'spacemacs/evil-insert-line-below)
           (evil-next-line)))

       (define-key evil-normal-state-map (kbd "<S-backspace>") 'split-line-indent))

     (leaf evil-extra-operator
       :ensure t
       :global-minor-mode global-evil-extra-operator-mode )


     (leaf evil-visualstar
       :ensure t
       :global-minor-mode global-evil-visualstar-mode )


   #+END_SRC

** mode specific 
*** ibuffer                                                      :deprecated:
    #+BEGIN_SRC emacs-lisp :tangle no
 ;; https://github.com/emacsmirror/evil/blob/master/evil-integration.el
 ;; Ibuffer
 (define-key ibuffer-mode-map (kbd  "<SPC>") nil)
 (progn
   (evil-make-overriding-map ibuffer-mode-map 'normal t)
   (evil-define-key 'normal ibuffer-mode-map
     "j" 'evil-next-line
     "k" 'evil-previous-line
     "RET" 'ibuffer-visit-buffer))
    #+END_SRC
*** w related mode 

    #+BEGIN_SRC emacs-lisp
      (progn
        (add-hook 'wdired-mode-hook #'evil-change-to-initial-state)
        (defadvice wdired-change-to-dired-mode (after evil activate)
          (evil-change-to-initial-state nil t)))



      ;; https://github.com/glynnforrest/emacs.d/blob/master/setup-occur-grep-ack.el

      (defun get-buffers-matching-mode (mode)
        "Returns a list of buffers where their major-mode is equal to MODE"
        (let ((buffer-mode-matches '()))
          (dolist (buf (buffer-list))
            (with-current-buffer buf
              (if (eq mode major-mode)
                  (add-to-list 'buffer-mode-matches buf))))
          buffer-mode-matches))

      (defun multi-occur-in-this-mode ()
        "Show all lines matching REGEXP in buffers with this major mode."
        (interactive)
        (multi-occur
         (get-buffers-matching-mode major-mode)
         (car (occur-read-primary-args))))

      (defun occur-goto-occurrence-recenter ()
        "Go to the occurrence on the current line and recenter."
        (interactive)
        (occur-mode-goto-occurrence)
        (recenter))

      ;; Preview occurrences in occur without leaving the buffer
      (defun occur-display-occurrence-recenter ()
        "Display the occurrence on the current line in another window and recenter."
        (interactive)
        (occur-goto-occurrence-recenter)
        (other-window 1))


      ;; Grep mode
      (defun grep-goto-occurrence-recenter ()
        "Go to the occurrence on the current line and recenter."
        (interactive)
        (compile-goto-error)
        (recenter))

      (defun grep-display-occurrence-recenter ()
        "Display the grep result of the current line in another window and recenter."
        (interactive)
        (grep-goto-occurrence-recenter)
        (other-window 1))


      (leaf wgrep
        :ensure t
        :config

        (w32-unix-eval
         ((evil-declare-key 'motion occur-mode-map (kbd "<return>")   'occur-goto-occurrence-recenter)
          (evil-declare-key 'motion grep-mode-map (kbd "<return>") 'grep-goto-occurrence-recenter)
          (evil-declare-key 'motion occur-mode-map (kbd "<S-return>") 'occur-display-occurrence-recenter)
          (evil-declare-key 'motion grep-mode-map (kbd "<S-return>") 'grep-display-occurrence-recenter)
          (evil-declare-key 'motion ack-and-a-half-mode-map (kbd "<return>") 'grep-goto-occurrence-recenter)
          (evil-declare-key 'motion ack-and-a-half-mode-map (kbd "<S-return>") 'grep-display-occurrence-recenter))
         ((evil-declare-key 'motion occur-mode-map (kbd "RET")   'occur-goto-occurrence-recenter)
          (evil-declare-key 'motion grep-mode-map (kbd "RET") 'grep-goto-occurrence-recenter)
          (evil-declare-key 'motion occur-mode-map (kbd "<S-RET>") 'occur-display-occurrence-recenter)
          (evil-declare-key 'motion grep-mode-map (kbd "<S-RET>") 'grep-display-occurrence-recenter)
          (evil-declare-key 'motion ack-and-a-half-mode-map (kbd "RET") 'grep-goto-occurrence-recenter)
          (evil-declare-key 'motion ack-and-a-half-mode-map (kbd "<S-RET>") 'grep-display-occurrence-recenter)))

        (evil-declare-key 'motion occur-mode-map "e" 'occur-edit-mode)
        (evil-declare-key 'motion occur-edit-mode-map "e" 'occur-cease-edit)
        (evil-declare-key 'motion grep-mode-map "e" 'wgrep-change-to-wgrep-mode)
        (evil-declare-key 'motion grep-mode-map "w" 'wgrep-save-all-buffers)
        ;;notuse;;(evil-declare-key 'motion ack-and-a-half-mode-map ",e" 'wgrep-change-to-wgrep-mode)
        ;;notuse;;(evil-declare-key 'motion ack-and-a-half-mode-map ",w" 'wgrep-save-all-buffers)
        (evil-declare-key 'motion wgrep-mode-map "e" 'wgrep-finish-edit)
        (evil-declare-key 'motion wgrep-mode-map "x" 'wgrep-abort-changes))


    #+END_SRC

    
*** ada-mode
    #+begin_src emacs-lisp
      (evil-define-key
        '(normal insert visual replace operator motion emacs)
        ada-mode-map
        (kbd "<f12>" ) 'toggle-parse-wisi)

    #+end_src

    #+RESULTS:

** sexp

**** paredit
     #+BEGIN_SRC emacs-lisp :tanble no
       ;;; https://github.com/laynor/emacs-conf/blob/master/site-lisp/evil-sexp/evil-sexp.el

       (defun beginning-and-end-of-sexp ()
         (destructuring-bind (b . e)
             (save-excursion
               (forward-char)
               (bounds-of-thing-at-point 'sexp))
           (cons b e)))

       (evil-define-motion evil-forward-sexp (count)
         :type inclusive
         (dotimes (i (or count 1))
           (let ((lookahead-1 (char-syntax (char-after (point))))
                 (lookahead-2 (char-syntax (char-after (1+ (point)))))
                 (new-point (point)))
             (condition-case nil
                 (progn (save-excursion
                          (message "lookahead1 = %S, lookahead-2 = %S"
                                   (string lookahead-1) (string lookahead-2))
                          (cond ((or (memq lookahead-2 '(?\ ?>))
                                     (member lookahead-1 '(?\ ?>)))
                                 (forward-char)
                                 (skip-syntax-forward "->")
                                 (setq new-point (point)))
                                (t (unless (memq lookahead-1 '(?\" ?\())
                                     (forward-char))
                                   (sp-forward-sexp)
                                   (backward-char)
                                   (setq new-point (point)))))
                        (goto-char new-point))
               (error (error "End of sexp"))))))

       (evil-define-motion evil-backward-sexp (count)
         :type inclusive
         (dotimes (i (or count 1))
           (let ((lookahead (char-syntax (char-after (point))))
                 (new-point (point)))
             (condition-case nil
                 (progn (save-excursion
                          (when (memq lookahead '(?\) ?\"))
                            (forward-char))
                          (sp-backward-sexp)
                          (setq new-point (point)))
                        (goto-char new-point))
               (error (error "Beginning of sexp"))))))

       (evil-define-motion evil-enter-sexp (count)
         :type inclusive
         (dotimes (i (or count 1))
           (let ((lookahead-1 (char-syntax (char-after (point))))
                 (lookahead-2 (char-syntax (char-after (1+ (point)))))
                 (lookbehind-1 (char-syntax (char-before (point))))
                 (lookbehind-2 (char-syntax (char-before (1- (point))))))
             (cond ((and (= lookahead-1 ?\()
                         (/= lookbehind-1 ?\\)
                         (= (char-after (1+ (point))) ?\n))
                    (forward-char)
                    (skip-syntax-forward "-"))
                   ((and (= lookahead-1 ?\()
                         (/= lookbehind-1 ?\\)
                         (/= lookahead-2 ?\)))
                    ;; do not move the cursor if it's on the opening paren of ()
                    (forward-char)
                    (skip-syntax-forward "-"))
                   ((and (= lookahead-1 ?\))
                         (or (/= lookbehind-1 ?\( )
                             (= lookbehind-2 ?\\)))
                    ;; do not move the cursor if it's on the closing paren of ()
                    (skip-syntax-backward "-")
                    (backward-char))
                   (t (error "Already at the deepest level"))))))



       ;; Does not work correctly when there are spaces after parens
       ;; does not work correctly when inside a string, check paredit.
       ;; check when there are spaces before parens
       ;; When the cursor is on an open paren, go up one level on an open paren
       (leaf paredit ;  (smartparens)
         :ensure t
         :config
         (evil-define-motion evil-exit-sexp (count)
           :type inclusive
           (dotimes (i (or count 1))
             (let (op-pos cl-pos)
               (condition-case nil
                   (progn (save-excursion
                            (sp-backward-up-sexp)
                            (setq op-pos (point))
                            (sp-forward-sexp)
                            (setq cl-pos (point)))
                          (let ((lookahead (char-syntax (char-after (point)))))
                            (case lookahead
                              (?\( (goto-char op-pos))
                              (?\) (goto-char cl-pos))
                              (otherwise (goto-char (if (> (abs (- (point) cl-pos))
                                                           (abs (- (point) op-pos)))
                                                        op-pos
                                                      cl-pos))))))
                 (error (error "Already at top-level."))))) )

         ;; (provide 'evil-sexp)


         (define-key evil-motion-state-map (kbd "H-j") 'evil-enter-sexp)
         (define-key evil-motion-state-map (kbd "H-k") 'evil-exit-sexp)
         (define-key evil-motion-state-map (kbd "H-h") 'evil-backward-sexp)
         (define-key evil-motion-state-map (kbd "H-l") 'evil-forward-sexp)
         (define-key evil-motion-state-map (kbd "<C-H-up>")     'buf-move-up)
         (define-key evil-motion-state-map (kbd "<C-H-down>")   'buf-move-down)
         (define-key evil-motion-state-map (kbd "<C-H-left>")   'buf-move-left)
         (define-key evil-motion-state-map (kbd "<C-H-right>")  'buf-move-right)
         (define-key evil-motion-state-map "zl" 'evil-forward-sexp)
         (define-key evil-motion-state-map "zh" 'evil-backward-sexp)
         (define-key evil-motion-state-map "zj" 'evil-enter-sexp)
         (define-key evil-motion-state-map "zk" 'evil-exit-sexp)

         (evil-define-key 'normal paredit-mode-map "\C-k" 'paredit-kill)
         (evil-define-key 'visual paredit-mode-map "\C-k" 'paredit-kill)
         (evil-define-key 'insert paredit-mode-map "\C-k" 'paredit-kill)
         )


       ;;; http://blog.binchen.org/?p=782
       (eval-after-load "evil" '(setq expand-region-contract-fast-key "z"))

     #+END_SRC
**** evil-cleverparens
     #+BEGIN_SRC emacs-lisp
     (add-hook 'elisp-mode  #'evil-cleverparens-mode)
     (add-hook 'scheme-mode #'evil-cleverparens-mode)
     #+END_SRC

     #+RESULTS:
     | evil-cleverparens-mode |

*** org 
**** org-show-current-heading-tidily
     #+BEGIN_SRC emacs-lisp
       (defun org-show-current-heading-tidily ()
         (interactive)  ;Inteactive
         "Show next entry, keeping other entries closed."
         (if (save-excursion (end-of-line) (outline-invisible-p))
             (progn (org-show-entry) (show-children))
           (outline-back-to-heading)
           (unless (and (bolp) (org-on-heading-p))
             (org-up-heading-safe)
             (hide-subtree)
             (error "Boundary reached"))
           (org-overview)
           (org-reveal t)
           (org-show-entry)
           (show-children)))




       (evil-leader/set-key-for-mode 'org-mode
         "ha" 'helm-org-agenda-files-headings
         "hH" 'helm-org-headings
         "A"  #'(lambda () (interactive) (switch-to-buffer "*Org Agenda*"))
         "hh" 'helm-org-in-buffer-headings

         "u"    'outline-up-heading
         "q"    'org-todo
         "<down>"    'outline-next-visible-heading
         "<up>"    'outline-previous-visible-heading
         "<right>"    'org-forward-heading-same-level
         "<left>"    'org-backward-heading-same-level

         "r"         'org-mark-ring-goto
         "&"         'org-mark-ring-goto

         "M" 'org-mime-org-buffer-htmlize
         "`" 'mu4e-message-send-and-exit
         "or" 'org-capture
         "oa" 'org-agenda
         "os" 'org-store-link
         "ol" 'org-insert-alllink
         "oo" 'org-open-at-point-global
         "oR" 'org-refile
         "oc" 'org-cliplink
         "od" 'org-deadline
         "oh" 'org-schedule
         "ot" 'org-set-tags
         "oT" 'org-time-stamp
         "ov" 'org-attach-screenshot
         "ob" 'org-iswitchb
         "ow" 'org-archive-subtree-default
         "op" 'org-link-copy-image
         "of" 'org-link-copy-file
         "oe" 'org-set-effort
         "oi" 'org-clock-in
         "oI" 'org-clock-out
         "w" 'org-archive-subtree-default
         "<f5>" 'org-redisplay-inline-images
         )



     #+END_SRC

     #+RESULTS:
     : t

**** evil-org 
     deprecated by evil-org
***** next deprecated 
    #+BEGIN_SRC emacs-lisp :tangle no


            (evil-leader/set-key-for-mode 'org-mode
              "ha" 'helm-org-agenda-files-headings
              "hH" 'helm-org-headings
              "A"  #'(lambda () (interactive) (switch-to-buffer "*Org Agenda*"))
              "hh" 'helm-org-in-buffer-headings

              "u"    'outline-up-heading
              "q"    'org-todo
              "<down>"    'outline-next-visible-heading
              "<up>"    'outline-previous-visible-heading
              "<right>"    'org-forward-heading-same-level
              "<left>"    'org-backward-heading-same-level

              "r"         'org-mark-ring-goto
              "&"         'org-mark-ring-goto


              "or" 'org-capture
              "oa" 'org-agenda
              "os" 'org-store-link
              "ol" 'org-insert-alllink
              "oo" 'org-open-at-point-global
              "oR" 'org-refile
              "oc" 'org-cliplink
              "od" 'org-deadline
              "oh" 'org-schedule
              "ot" 'org-set-tags
              "oT" 'org-time-stamp
              "ov" 'org-attach-screenshot
              "ob" 'org-iswitchb
              "ow" 'org-archive-subtree-default
              "op" 'org-link-copy-image
              "of" 'org-link-copy-file
              "oe" 'org-set-effort
              "oi" 'org-clock-in
              "oI" 'org-clock-out
              "w" 'org-archive-subtree-default
              )

            (leaf evil-org
              :ensure t
              :config
              (evil-define-key 'normal evil-org-mode
                "=" 'org-show-current-heading-tidily
                ;;deprecatedby-evil-org;;"<" 'org-shiftleft
                ;;deprecatedby-evil-org;;">" 'org-shiftright
                (kbd "<f2>") 'org-insert-structure-template
                (kbd "<kp-multiply>") 'org-insert-star
                (kbd "RET") 'org-open-at-point
                "za" 'org-cycle
                "zA" 'org-shifttab
                "zm" 'hide-body
                "zr" 'show-all
                "zo" 'show-subtree
                "zO" 'show-all
                "zc" 'hide-subtree
                "zC" 'hide-all
                (kbd "<S-next>") 'evil-forward-paragraph
                (kbd "<S-prev>") 'evil-backward-paragraph

                "gn"    'outline-next-visible-heading
                "gp"    'outline-previous-visible-heading
                "gf"    'org-forward-heading-same-level
                "gb"    'org-backward-heading-same-level
                "gu"    'outline-up-heading
                "gt"    'org-goto

                ;;deprecatedby-evil-org;;"gj"    'outline-next-visible-heading
                ;;deprecatedby-evil-org;;"gk"    'outline-previous-visible-heading
                ;;deprecatedby-evil-org;;"gl"    'org-forward-heading-same-level
                ;;deprecatedby-evil-org;;"gh"    'org-backward-heading-same-level

                (kbd "<kp-multiply>") 'org-insert-star
                (kbd "M-j") 'org-shiftleft
                (kbd "M-k") 'org-shiftright
                (kbd "M-H") 'org-metaleft
                (kbd "M-J") 'org-metadown
                (kbd "M-K") 'org-metaup
                (kbd "M-L") 'org-metaright
                )

              (evil-define-key 'visual evil-org-mode
                "gn"    'outline-next-visible-heading
                "gp"    'outline-previous-visible-heading
                "gf"    'org-forward-heading-same-level
                "gb"    'org-backward-heading-same-level
                "gu"    'outline-up-heading
                "gt"    'org-goto
                (kbd "<S-next>") 'evil-forward-paragraph
                (kbd "<S-prev>") 'evil-backward-paragraph
                ;;deprecatedby-evil-org;;"gj" (if (fboundp 'org-forward-same-level) 'org-forward-same-level 'org-forward-heading-same-level)
                ;;deprecatedby-evil-org;;"gk" (if (fboundp 'org-backward-same-level) 'org-backward-same-level 'org-backward-heading-same-level)
                ;;deprecatedby-evil-org;;"gl" 'outline-next-visible-heading

                ;;deprecatedby-evil-org;;"gj"    'outline-next-visible-heading
                ;;deprecatedby-evil-org;;"gk"    'outline-previous-visible-heading
                ;;deprecatedby-evil-org;;"gl"    'org-forward-heading-same-level
                ;;deprecatedby-evil-org;;"gh"    'org-backward-heading-same-level

                )


              (evil-define-key 'normal orgstruct-mode
                (kbd "RET") 'org-open-at-point
                "za" 'org-cycle
                "zA" 'org-shifttab
                "zm" 'hide-body
                "zr" 'show-all
                "zo" 'show-subtree
                "zO" 'show-all
                "zc" 'hide-subtree
                "zC" 'hide-all
                (kbd "M-j") 'org-shiftleft
                (kbd "M-k") 'org-shiftright
                (kbd "M-H") 'org-metaleft
                (kbd "M-J") 'org-metadown
                (kbd "M-K") 'org-metaup
                (kbd "M-L") 'org-metaright)

              (evil-define-key 'insert evil-org-mode
                (kbd "<f2>") 'org-insert-structure-template
                (kbd "M-j") 'org-shiftleft
                (kbd "M-k") 'org-shiftright
                (kbd "M-H") 'org-metaleft
                (kbd "M-J") 'org-metadown
                (kbd "M-K") 'org-metaup
                (kbd "M-L") 'org-metaright
                (kbd "<M-return>") 'org-meta-return
                (kbd "<S-next>") 'evil-forward-paragraph
                (kbd "<S-prev>") 'evil-backward-paragraph)

              (evil-define-key 'insert orgstruct-mode-map
                (kbd "M-j") 'org-shiftleft
                (kbd "M-k") 'org-shiftright
                (kbd "M-H") 'org-metaleft
                (kbd "M-J") 'org-metadown
                (kbd "M-K") 'org-metaup
                (kbd "M-L") 'org-metaright)

              )


    #+END_SRC
***** use this

      #+BEGIN_SRC emacs-lisp

        (leaf evil-org
          :ensure t
          :config
          (evil-define-key '(normal insert visual ) 'evil-org-mode
            (kbd "<f2>") 'org-insert-structure-template
            (kbd "<kp-multiply>") 'org-insert-star
            (kbd "<kp-subtract>") 'wsl-open-org-link))

        (evil-define-key 'normal outline-mode-map
          "gh"    'outline-up-heading
          "gn"    'outline-next-heading
          "gN"    'outline-next-visible-heading
          "gp"    'outline-previous-heading
          "gP"    'outline-previous-visible-heading
          "gl"    'goto-line
          "gf"    'org-forward-heading-same-level
          "gb"    'org-backward-heading-same-level
          "gu"    'outline-up-heading
          ;;"gt"    'org-goto
          )

        (evil-define-key 'visual outline-mode-map
          "gh"    'outline-up-heading
          "gn"    'outline-next-heading
          "gN"    'outline-next-visible-heading
          "gp"    'outline-previous-heading
          "gP"    'outline-previous-visible-heading
          "gl"    'goto-line
          "gf"    'org-forward-heading-same-level
          "gb"    'org-backward-heading-same-level
          "gu"    'outline-up-heading
          ;;"gt"    'org-goto
          )

      #+END_SRC

      #+RESULTS:

*** mu4e
**** leader key
     #+BEGIN_SRC emacs-lisp 
       
   (evil-leader/set-key-for-mode 'mu4e-compose-mode
     "`" 'mu4e-message-send-and-exit)

     #+END_SRC

     #+RESULTS:

     - kim
     - dong
     - il
**** deprecated
     #+BEGIN_SRC emacs-lisp :tangle no
       (leaf evil-mu4e
         :ensure t
         :config
         (mapcar 
          (lambda (x)
            (add-to-list 'evil-mu4e-mode-map-bindings `(normal mu4e-main-mode-map ,(car x) ,(cadr x ))))
          '(
            ("B"               mu4e-headers-search-bookmark-edit)
            ("s"               mu4e-headers-search)))
         (mapcar 
          (lambda (x)
            (add-to-list 'evil-mu4e-mode-map-bindings `(normal mu4e-view-mode-map ,(car x) ,(cadr x ))))
          '(
            ("*"             bmkp-mu4e-view)
            ("<home>"             open-mu4e-view)   ;open in outlook
            ("<kp-multiply>" bmkp-mu4e-view)
            ("@"             copy-mu4e-view)
            ("B"               mu4e-headers-search-bookmark-edit)
            (,(kbd "<f12>F")             mu4e-find-file)
            (,(kbd "<f12>f")             mu4e-field-view)
            ("o" mu4e-view-open-attachment)
            ("O" mu4e-view-open-attachment-emacs)
            ("s"               mu4e-headers-search)
            ("S" mu4e-view-save-attachment)
            ("U" mu4e-mark-unmark-all)
            ("x"             mu4e-mark-execute-all )))
         (mapcar 
          (lambda (x)
            (add-to-list 'evil-mu4e-mode-map-bindings `(normal mu4e-headers-mode-map ,(car x) ,(cadr x ))))
          '(
            ("*"             bmkp-mu4e-header)
            ("<home>"             open-mu4e-view)   ;open in outlook
            ("<insert>"        mu4e-headers-mark-for-something)   ;open in outlook
            ("<kp-multiply>" bmkp-mu4e-header)
            ("@"             copy-mu4e-header)
            ("B"               mu4e-headers-search-bookmark-edit)
            (,(kbd "<f12>F")             mu4e-find-file)
            (,(kbd "<f12>f")             mu4e-field-header)
            ("s"               mu4e-headers-search)
            ("i"               mu4e-conversation)
            ("U" mu4e-mark-unmark-all)
            ("u" mu4e-headers-mark-for-unmark)
            ("x"             mu4e-mark-execute-all )))
         (evil-mu4e-init)
         (evil-define-key 'normal mu4e-headers-mode-map
           "?" mu4e-headers-mode-map)
         (evil-define-key 'normal mu4e-view-mode-map
            "?" mu4e-view-mode-map))
 
       #+END_SRC
 
*** python

     #+BEGIN_SRC emacs-lisp 

       (evil-leader/set-key-for-mode 'python-mode
         "ss" 'python-shell-send-statement)

     #+END_SRC


*** dired                 
    

**** helm-dired-history 
     #+BEGIN_SRC emacs-lisp 
       (evil-define-key 'normal dired-mode-map ",h" #'helm-dired-history-view)
       (evil-define-key 'normal dired-mode-map ",2" #'2zip)
       (evil-define-key 'normal dired-mode-map ",7" #'2-7zip)
     #+END_SRC

     #+RESULTS:

**** dired mapping  
***** deprecated 
 #+BEGIN_SRC emacs-lisp :tangle no
        ;;  (use-package dired
        ;;    :config
        ;;;;; Dired
        ;;    (define-key dired-mode-map (kbd "SPC") nil)
        ;;    (define-key dired-mode-map (kbd "/") nil)
        ;;    (define-key dired-mode-map (kbd "n") nil)
        ;;    (define-key dired-mode-map (kbd "N") nil)
        ;;    
        ;;    ;; use the standard Dired bindings as a base
        ;;    (evil-make-overriding-map dired-mode-map 'normal t)
        ;;    (evil-add-hjkl-bindings dired-mode-map 'normal
        ;;      "J" 'dired-goto-file     ; "j"
        ;;      "K" 'dired-do-kill-lines ; "k"
        ;;      ;; "r" 'dired-do-redisplay  ; "l"
        ;;      "r" 'revert-buffer
        ;;      ;; "g" 'revert-buffer
        ;;      (kbd  "RET") 'diredp-find-file-reuse-dir-buffer
        ;;      ";" (lookup-key dired-mode-map ":")) ; ":d", ":v", ":s", ":e"
        ;;    (evil-define-key 'normal dired-mode-map "R" 'dired-do-rename)
        ;;    ;;evil-extra-operator;;(evil-define-key 'normal dired-mode-map "gg" 'revert-buffer)
        ;;    ;;evil-extra-operator;;(evil-declare-key 'normal dired-mode-map "g" 'revert-buffer)
        ;;    (define-key dired-mode-map ":;" 'dired-sort-menu-toggle-dirs-first))
 #+END_SRC

***** v make visual
      #+begin_src emacs-lisp
       (evil-define-key 'normal dired-mode-map "v" #'evil-visual-char)
      #+end_src
***** list files
      #+begin_src emacs-lisp
        (evil-define-key 'normal dired-mode-map (kbd "<f6>") #'diredp-list-marked)
      #+end_src
*** key combo

    #+BEGIN_SRC emacs-lisp
      (leaf key-combo
        :ensure t
        :hook
        (c++-mode-hook .
                       (lambda ()
                         (key-combo-mode t)
                         (key-combo-define evil-insert-state-map (kbd "-")  '("-" "_"))))
        :config
        ;;   (global-key-combo-mode t)
        ;;   (key-combo-define evil-insert-state-map (kbd "=") '(" = " " == " "=" " === "))
        ;;   (key-combo-define evil-insert-state-map (kbd "+") '(" + " "+" " += " "++"))
        ;;   (key-combo-define evil-insert-state-map (kbd "-") '("-" " - " " -= " "--"))
        ;;   (key-combo-define evil-insert-state-map (kbd "*") '(" * " "*" " *= "))
        ;;   (key-combo-define evil-normal-state-map (kbd "/") 'key-combo-execute-orignal)
        ;;   (key-combo-define evil-insert-state-map (kbd "/") '("/" " / " " /= " "/* `!!' */" "//"))
        ;;   (key-combo-define evil-insert-state-map (kbd "%") '("%" " % " " %= "))
        ;;   (key-combo-define evil-insert-state-map (kbd "!") '("!" " != "))
        ;;   (key-combo-define evil-insert-state-map (kbd "&") '(" && " "&"))
        ;;   (key-combo-define evil-insert-state-map (kbd "|") '(" || " "|"))
        ;;   (key-combo-define evil-insert-state-map (kbd "?") '(" ? " "?"))
        ;;   (key-combo-define evil-insert-state-map (kbd ",") '(", " "," ",\n"))
        ;;   (key-combo-define evil-insert-state-map (kbd "{") '("{\n`!!'\n}" "{" "{`!!'}" "{}"))
        ;;   (key-combo-define evil-insert-state-map (kbd "(") '("(`!!')" "(" "()"))
        ;;   (key-combo-define evil-insert-state-map (kbd "[") '("[`!!']" "[" "[]"))
        ;;   (key-combo-define evil-insert-state-map (kbd "<")  '(" < " " <= " " < " " << " "<<" "<`!!'>"))
        ;;   (key-combo-define evil-insert-state-map (kbd ">")  '(" > " " >= " " > " " >> " ">>"))
        ;;   (key-combo-define evil-insert-state-map (kbd "\"") '("\"`!!'\""  "\""  "\"\"\"`!!'\"\"\""))
        ;;   (key-combo-define evil-insert-state-map (kbd ";") '(";\n" ";"))
        ;;   (add-hook 'web-mode-hook (lambda()
        ;;     (key-combo-define evil-insert-state-map (kbd "<")  '("<" "<`!!'>"))
        ;;     (key-combo-define evil-insert-state-map (kbd "/")  '("/" "</`!!'>"))
        ;;     (key-combo-define evil-insert-state-map (kbd ">")  '(">"))
        ;;     (key-combo-define evil-insert-state-map (kbd "=")  '("="))
        ;;     (key-combo-define evil-insert-state-map (kbd "*")  '("*"))
        ;;     (key-combo-define evil-insert-state-map (kbd "!")  '("!" "<!-- `!!' -->"))
        ;;   ))

        )

    #+END_SRC
*** key guide

    #+BEGIN_SRC emacs-lisp
      ;;; guide-key 
      ;; @see https://bitbucket.org/lyro/evil/issue/511/let-certain-minor-modes-key-bindings


      ;; [[file:t:/gitdir/dot-emacs/etc/hyone-key-combo.el::(defun%20evil-key-combo-define%20(state%20keymap%20key%20commands)][combo for evil]]

      ;; (use-package guide-key
      ;;   :config
      ;;   (guide-key-mode)
      ;;   (defun guide-key-hook-function-for-org-mode ()
      ;;     (guide-key/add-local-guide-key-sequence "C-c")
      ;;     (guide-key/add-local-guide-key-sequence "C-c C-x")
      ;;     (guide-key/add-local-highlight-command-regexp "org-"))
      ;;   (add-hook 'org-mode-hook 'guide-key-hook-function-for-org-mode))

      (leaf which-key
        :ensure t
        :global-minor-mode which-key-mode
        :custom ((which-key-popup-type . 'side-window)
                 (which-key-side-window-max-width . 0.5))
        :config 
        ( which-key-setup-side-window-right))

    #+END_SRC

*** magit
    #+BEGIN_SRC emacs-lisp

      ;; (use-package magit
      ;;   :commands magit-status magit-diff magit-log magit-blame-mode
      ;;   :init
      ;;   (evil-leader/set-key
      ;;     "g t" 'magit-status
      ;;     "g b" 'magit-blame-mode
      ;;     "g l" 'magit-log
      ;;     "g d" 'magit-diff)
      ;;   :config
      ;;   (progn
      ;;     (evil-make-overriding-map magit-mode-map 'emacs)
      ;;     (define-key magit-mode-map "\C-w" 'evil-window-map)
      ;;     (evil-define-key 'emacs magit-mode-map "j" 'magit-goto-next-section)
      ;;     (evil-define-key 'emacs magit-mode-map "k" 'magit-goto-previous-section)
      ;;     (evil-define-key 'emacs magit-mode-map "K" 'magit-discard-item))) 


      (leaf git-timemachine
        :ensure t
        ;; force update evil keymaps after git-timemachine-mode loaded
        :hook
        (git-timemachine-mode-hook . evil-normalize-keymaps)
        :config
        (evil-make-overriding-map git-timemachine-mode-map 'normal))


      (leaf evil-magit :ensure t)

    #+END_SRC

*** mathinput
    #+BEGIN_SRC emacs-lisp :tangle on
      (leaf xah-math-input-mode
        :ensure t
        :config
        (evil-declare-key 'normal xah-math-input-keymap [f9] 'xah-math-input-change-to-symbol)
        (evil-declare-key 'insert xah-math-input-keymap [f9] 'xah-math-input-change-to-symbol)
        (evil-declare-key 'visual xah-math-input-keymap [f9] 'xah-math-input-change-to-symbol))
    #+END_SRC
    
*** deprecated
    #+BEGIN_SRC emacs-lisp
;;deprecated;;(defun gf/narrow-grep-buffer ()
;;deprecated;;  "Narrow the grep buffer stripping out the really long grep command."
;;deprecated;;  (interactive)
;;deprecated;;  (goto-line 5)
;;deprecated;;  (narrow-to-region (point) (point-max))
;;deprecated;;  (goto-line 1))
;;deprecated;;
;;deprecated;;(define-key evil-normal-state-map (kbd "C-c g")
;;deprecated;;  (lambda()
;;deprecated;;    (interactive)
;;deprecated;;    (call-interactively 'projectile-ack)
;;deprecated;;    (other-window 1)
;;deprecated;;    (gf/narrow-grep-buffer)
;;deprecated;;    ))
    #+END_SRC


*** occur
    
       #+begin_src emacs-lisp :tangle no
       (evil-define-key 'normal occur-mode-map "y" #'evil-yank)
       #+end_src

       #+RESULTS:

** bind map
   #+BEGIN_SRC emacs-lisp
     (leaf evil-lisp-state
       :ensure t
       :config
       (let ((leader ","))
         (bind-map evil-lisp-state-map
           :evil-keys (leader)
           :major-modes (emacs-lisp-mode)
           :evil-states (normal lisp))
         (bind-map evil-lisp-state-major-mode-map
           :evil-keys (leader)
           :evil-states (normal lisp)
           :major-modes (emacs-lisp-mode))) )
   #+END_SRC

   #+RESULTS:
   : t

** enriched mode
   #+begin_src emacs-lisp
       (spacemacs/set-leader-keys-for-minor-mode 'enriched-mode
         "o" facemenu-keymap)
   #+end_src

   #+RESULTS:

** evil start

   #+BEGIN_SRC emacs-lisp
 (evil-mode 1)
   #+END_SRC

** evil-innter-text
   #+BEGIN_SRC emacs-lisp
   (define-key evil-inner-text-objects-map "k" 'evil-textobj-column-word)
   (define-key evil-inner-text-objects-map "K" 'evil-textobj-column-word)
   #+END_SRC
** unimpaired
   #+BEGIN_SRC emacs-lisp
   (define-key evil-normal-state-map (kbd "[ B") 'iflipb-previous-buffer)
   (define-key evil-normal-state-map (kbd "] B") 'iflipb-next-buffer)


   (define-key evil-visual-state-map (kbd "[ c") 'copy-heading-striped)
   (define-key evil-normal-state-map (kbd "[ c") 'copy-kill-ring-top-heading-striped) 


   #+END_SRC

   #+RESULTS:
   : iflipb-next-buffer

** jump
   #+begin_src emacs-lisp
     (defun advice/save-imenu-jump (item)
       (evil--jumps-push))

     (advice-add 'imenu :before 'advice/save-imenu-jump)
   #+end_src

   #+RESULTS:

* bind map                                                       :DEPRECATED:
#+BEGIN_SRC emacs-lisp :tangle no

  (leaf bind-map
    :ensure t
    :config
    (bind-map-set-keys helm-ag-map
      (kbd "<f2>") 'helm-ag-edit
      (kbd "<f3>") 'helm-ag--run-save-buffer)
    (bind-map-set-keys helm-grep-map
      (kbd "<f3>") 'helm-grep-run-save-buffer))

#+END_SRC

#+RESULTS:
: t



* lion mode 
[[https://github.com/edkolev/evil-lion][GitHub - edkolev/evil-lion: Evil align operator]]
#+BEGIN_SRC emacs-lisp
  (leaf evil-lion
    :ensure t
    :global-minor-mode evil-lion-mode)
#+END_SRC

#+RESULTS:
: t
* switch-window
  #+BEGIN_SRC emacs-lisp
    (leaf switch-window
      :ensure t
      :custom (( switch-window-shortcut-style . 'qwerty)
               ( switch-window-querty-shortcuts . '("a" "s" "d" "f" "j" "k" "l" ";" "w" "e" "i" "o")))
      :bind
      (( (kbd "<f12>") . dired)
       ( (kbd "<f22>") . switch-to-buffer)
       ( (kbd "<M-f12>") . switch-window-then-dired))
      ;;(global-set-key (kbd "<S-f12>") 'switch-window-then-find-file)
      ;;(global-set-key (kbd "C-x o") 'switch-window)
      ;;(global-set-key (kbd "C-x 1") 'switch-window-then-maximize)
      ;;(global-set-key (kbd "C-x 2") 'switch-window-then-split-below)
      ;;(global-set-key (kbd "C-x 3") 'switch-window-then-split-right)
      ;;(global-set-key (kbd "C-x 0") 'switch-window-then-delete)
      ;;
      ;;(global-set-key (kbd "C-x 4 d") 'switch-window-then-dired)
      ;;(global-set-key (kbd "C-x 4 f") 'switch-window-then-find-file)
      ;;(global-set-key (kbd "C-x 4 m") 'switch-window-then-compose-mail)
      ;;(global-set-key (kbd "C-x 4 r") 'switch-window-then-find-file-read-only)
      ;;
      ;;(global-set-key (kbd "C-x 4 C-f") 'switch-window-then-find-file)
      ;;(global-set-key (kbd "C-x 4 C-o") 'switch-window-then-display-buffer)
      ;;
      ;;(global-set-key (kbd "C-x 4 0") 'switch-window-then-kill-buffer)
      )

  #+END_SRC

  #+RESULTS:
* garbage-collection
  
  #+begin_src emacs-lisp
    (global-set-key (kbd "<C-f33>")
                    (lambda ()
                      (interactive)
                      (save-some-buffers t
                                         #'(lambda ()
                                             (and (not buffer-read-only)
                                                  (buffer-file-name))))
                      (garbage-collect)))

    (global-set-key (kbd "<f33>") 'keyboard-quit)

  #+end_src

  #+RESULTS:
  : keyboard-quit

* evil-states
** normal state
   #+BEGIN_SRC emacs-lisp
   (append-to-list 'evil-normal-state-modes '(mu4e-compose-mode occur-mode occur-edit-mode))
   #+END_SRC
   
** emacs state
   #+BEGIN_SRC emacs-lisp
     (append-to-list
      'evil-emacs-state-modes
      '(
        svn-status-mode
        dvc-log-edit-mode
        project-buffer-mode
        gtags-selection-mode
        speedbar-mode
        picpocket-mode
        vterm-mode
        elfeed-mode
        bufler-mode
        bufler-list-mode
        ))
   #+END_SRC

   #+RESULTS:
   | org-brain-visualize-mode | 5x5-mode | bbdb-mode | biblio-selection-mode | blackbox-mode | bookmark-bmenu-mode | bookmark-edit-annotation-mode | browse-kill-ring-mode | bubbles-mode | bzr-annotate-mode | calc-mode | cfw:calendar-mode | completion-list-mode | custom-theme-choose-mode | debugger-mode | delicious-search-mode | desktop-menu-blist-mode | desktop-menu-mode | dun-mode | dvc-bookmarks-mode | dvc-diff-mode | dvc-info-buffer-mode | dvc-log-buffer-mode | dvc-revlist-mode | dvc-revlog-mode | dvc-status-mode | dvc-tips-mode | ediff-mode | ediff-meta-mode | efs-mode | Electric-buffer-menu-mode | emms-browser-mode | emms-mark-mode | emms-metaplaylist-mode | emms-playlist-mode | ess-help-mode | etags-select-mode | fj-mode | gc-issues-mode | gdb-breakpoints-mode | gdb-disassembly-mode | gdb-frames-mode | gdb-locals-mode | gdb-memory-mode | gdb-registers-mode | gdb-threads-mode | gist-list-mode | gnus-article-mode | gnus-browse-mode | gnus-group-mode | gnus-server-mode | gnus-summary-mode | gomoku-mode | google-maps-static-mode | jde-javadoc-checker-report-mode | magit-popup-mode | magit-popup-sequence-mode | mh-folder-mode | monky-mode | mpuz-mode | notmuch-hello-mode | notmuch-search-mode | notmuch-show-mode | notmuch-tree-mode | pdf-outline-buffer-mode | pdf-view-mode | proced-mode | rcirc-mode | rebase-mode | recentf-dialog-mode | reftex-select-bib-mode | reftex-select-label-mode | reftex-toc-mode | sldb-mode | slime-inspector-mode | slime-thread-control-mode | slime-xref-mode | snake-mode | solitaire-mode | sr-buttons-mode | sr-mode | sr-tree-mode | sr-virtual-mode | tetris-mode | tla-annotate-mode | tla-archive-list-mode | tla-bconfig-mode | tla-bookmarks-mode | tla-branch-list-mode | tla-browse-mode | tla-category-list-mode | tla-changelog-mode | tla-follow-symlinks-mode | tla-inventory-file-mode | tla-inventory-mode | tla-lint-mode | tla-logs-mode | tla-revision-list-mode | tla-revlog-mode | tla-tree-lint-mode | tla-version-list-mode | twittering-mode | urlview-mode | vm-mode | vm-summary-mode | w3m-mode | wab-compilation-mode | xgit-annotate-mode | xgit-changelog-mode | xgit-diff-mode | xgit-revlog-mode | xhg-annotate-mode | xhg-log-mode | xhg-mode | xhg-mq-mode | xhg-mq-sub-mode | xhg-status-extra-mode | magit-show-branches-mode | svn-status-mode | dvc-log-edit-mode | project-buffer-mode | gtags-selection-mode | speedbar-mode | picpocket-mode | vterm-mode | elfeed-mode | magit-show-branches-mode | svn-status-mode | dvc-log-edit-mode | project-buffer-mode | gtags-selection-mode | speedbar-mode | picpocket-mode | vterm-mode | elfeed-mode | bufler-mode | svn-status-mode | dvc-log-edit-mode | project-buffer-mode | gtags-selection-mode | speedbar-mode | picpocket-mode | vterm-mode | elfeed-mode | bufler-mode | bufler-list-mode |

** emacs-motion state 
   #+BEGIN_SRC emacs-lisp
     (append-to-list
      'evil-motion-state-modes
      '(spacemacs-buffer-mode
       magit-repolist-mode
       view-mode
       grep-mode))
   #+END_SRC
* evil-search-highlight-persist

  #+begin_src emacs-lisp
    (leaf evil-search-highlight-persist :ensure t)
  #+end_src

  #+RESULTS:
* evil-tex
  #+begin_src emacs-lisp
    (leaf evil-tex
      :ensure t
      :hook
      (LaTeX-mode-hook . evil-tex-mode))
  #+end_src

  #+RESULTS:
  : t

* text-object
Update: evil-regexp-range was recently replaced with evil-select-paren. This works on current evil and has the same usage as the old one:

** macro
 #+begin_src emacs-lisp


   (defmacro define-and-bind-text-object (name key start-regex end-regex)
     (let ((inner-name (make-symbol (s-append "-inner-name" name)))
           (outer-name (make-symbol (s-append "-outer-name" name))))
       `(progn
          (evil-define-text-object ,inner-name (count &optional beg end type)
            (evil-select-paren ,start-regex ,end-regex beg end type count nil))
          (evil-define-text-object ,outer-name (count &optional beg end type)
            (evil-select-paren ,start-regex ,end-regex beg end type count t))
          (define-key evil-inner-text-objects-map ,key (quote ,inner-name))
          (define-key evil-outer-text-objects-map ,key (quote ,outer-name)))))

  (define-and-bind-text-object "cblock" "c" "<\[0-9\]\\{8\\}W\[0-9\]\\{2\\}" "\[0-9\]\\{8\\}W\[0-9\]\\{2\\}>")

 #+end_src

 #+RESULTS:
 : define-and-bind-text-object

** Usage:


 #+begin_src emacs-lisp :tangle no
 ; between dollar signs:
 (define-and-bind-text-object "$" "\\$" "\\$")

 ; between pipe characters:
 (define-and-bind-text-object "|" "|" "|")

 ; from regex "b" up to regex "c", bound to k (invoke with "vik" or "vak"):
 (define-and-bind-text-object "k" "b" "c")
 #+end_src

** example


#+begin_quote
Posted byu/VanLaser
4 years ago
evil 'il/al' and 'ie/ae' text-objects

In Vim, I was used with Kana's custom il, al and ie, ae text-objects, that can select in an inclusive or exclusive way (without trailing space characters) the current line or the entire buffer, respectively.

One way to have the same functionality in Emacs+Evil is based on the regex-based define-and-bind-text-object awesome macro definition, and is as simple as that:

  ;; create "il"/"al" (inside/around) line text objects:
  (define-and-bind-text-object "l" "^\\s-*" "\\s-*$")
  ;; create "ie"/"ae" (inside/around) entire buffer text objects:
  (define-and-bind-text-object "e" "\\`\\s-*" "\\s-*\\'")

So now I can run for example yae to copy the entire buffer content to the default register, or dil to delete the current line without the trailing spaces or tabs (or use them with a custom operator such as "google translate").

I hope it helps others vimacsers too!

In the second case (entire buffer), is the regex fast, or it gets slow with large buffers (e.g. compared to a solution based on beginning-of-buffer, end-of-buffer)?
#+end_quote

* evil-collection
** mu4e
   #+begin_src emacs-lisp

     (leaf evil-collection
       :ensure t 
       :config

       (evil-collection-init '( diff-mode mu4e))

       (let ((bindings `((mu4e-view-mode-map 
                          "*"             bmkp-mu4e-view
                          ,(kbd "<home>")             open-mu4e-view   ;open in outlook
                          ,(kbd "<insert>")           mu4e-headers-mark-for-something   ;open in outlook
                          ,(kbd "<kp-multiply>") bmkp-mu4e-view
                          "@"             copy-mu4e-view
                          ,(kbd "<f12>F")             mu4e-find-file
                          ,(kbd "<f12>f")             mu4e-field-view
                          "o" mu4e-view-open-attachment
                          "O" mu4e-view-open-attachment-emacs
                          "m"  	mu4e-view-mark-for-tag
                          "#"  	mu4e-mark-resolve-deferred-marks)
                         (mu4e-headers-mode-map 
                          ,(kbd "<home>")             open-mu4e-view   ;open in outlook
                          ,(kbd "<insert>")        mu4e-headers-mark-for-something   ;open in outlook
                          ,(kbd "<kp-multiply>") bmkp-mu4e-header
                          "@"             copy-mu4e-header
                          ,(kbd "<f12>F")             mu4e-find-file
                          ,(kbd "<f12>f")             mu4e-field-header
                          "L"  	mu4e-occur-store-link))))

         (dolist (binding bindings)
           (apply #'evil-collection-define-key 'normal binding))))



   #+end_src

   #+RESULTS:
   
** block-nav
   #+begin_src emacs-lisp
     (leaf block-nav
       :ensure t
       :config
       (dolist (modemap '(python-mode-map c++-mode-map))
         (evil-collection-define-key '(normal visual) modemap
           [kp-6] 'block-nav-next-block
           [kp-4] 'block-nav-previous-block
           [kp-2] 'block-nav-next-indentation-level
           [kp-4] 'block-nav-previous-indentation-level
           [kp-5] 'block-nav-move-indentation-level)))
   #+end_src

   #+RESULTS:
   
